@{
    var X = Html.X();
}
@(
    //只能取，不能设？送出去
    X.Hidden().ID((string)ViewData["DataComboBox_ID"] + "_GetSelID").Value("")
        .DirectEvents(de =>
        {
            de.Change.Url = Url.Action("ChangeGetSelID", "DataComboBox", new { Area = "UserControl" });
            de.Change.ExtraParams.Add(new Parameter()
            {
                Name = "PanelID",
                Value = ((string)ViewData["DataComboBox_ID"]),
                Mode = ParameterMode.Value
            });
            de.Change.ExtraParams.Add(new Parameter()
            {
                Name = "sSelID",
                Value = "this.getValue()",
                Mode = ParameterMode.Raw
            });
            de.Change.ExtraParams.Add(new Parameter()
            {
                Name = "ParentVariable",
                Value = "App." + (string)ViewData["DataComboBox_ID"] + "_ParentVariable" + ".getValue()",
                Mode = ParameterMode.Raw
            });
        })
)
@(
    //只能设，不能取？-1:设定第一个值;0清空;其他值
    X.Hidden().ID((string)ViewData["DataComboBox_ID"] + "_SetSelID").Value("")
        .DirectEvents(de =>
        {
            de.Change.Url = Url.Action("ChangeSetSelID", "DataComboBox", new { Area = "UserControl" });
            de.Change.ExtraParams.Add(new Parameter()
            {
                Name = "PanelID",
                Value = ((string)ViewData["DataComboBox_ID"]),
                Mode = ParameterMode.Value
            });
            de.Change.ExtraParams.Add(new Parameter()
            {
                Name = "sSelID",
                Value = "this.getValue()",
                Mode = ParameterMode.Raw
            });
            de.Change.ExtraParams.Add(new Parameter()
            {
                Name = "sInitFlag",
                Value = "App." + (string)ViewData["DataComboBox_ID"] + "_InitFlag" + ".getValue()",
                Mode = ParameterMode.Raw
            });

        })
)

@(X.Hidden().ID((string)ViewData["DataComboBox_ID"] + "_ParentVariable").Text(""))
@(X.Hidden().ID((string)ViewData["DataComboBox_ID"] + "_NowNames").Text(""))
@(X.Hidden().ID((string)ViewData["DataComboBox_ID"] + "_NowValues").Text(""))
@(X.Hidden().ID((string)ViewData["DataComboBox_ID"] + "_NowSigns").Text(""))
@(X.Hidden().ID((string)ViewData["DataComboBox_ID"] + "_InitFlag").Text("0"))
@(X.Hidden().ID((string)ViewData["DataComboBox_ID"] + "_Disabled").Text("0")
    .DirectEvents(de =>
    {
        de.Change.Url = Url.Action("ChangeComboDisabled", "DataComboBox", new { Area = "UserControl" });
        de.Change.ExtraParams.Add(new Parameter()
        {
            Name = "PanelID",
            Value = ((string)ViewData["DataComboBox_ID"]),
            Mode = ParameterMode.Value
        });
        de.Change.ExtraParams.Add(new Parameter()
        {
            Name = "disable",
            Value = "this.getValue()",
            Mode = ParameterMode.Raw
        });
    })
)
@(
    X.ComboBox()
        .ID((string)ViewData["DataComboBox_ID"])
        .AnchorHorizontal("100%")
        .DisplayField("name")
        .ValueField("id")
        .AutoDataBind(false)
        //.Editable(false)
        .QueryMode(DataLoadMode.Local)
        .EmptyText("全部")
        .Store(
            X.Store()
                .ID((string)ViewData["DataComboBox_ID"] + "_Store")
                .AutoLoad(false)
                .Model(X.Model()
                    .IDProperty("ID")
                    .Fields(
                        new ModelField("id", ModelFieldType.String) { Mapping = "ID" },
                        new ModelField("name", ModelFieldType.String) { Mapping = "Name" }
                    )
                )
                .Proxy(X.AjaxProxy()
                    .Url(Url.Action("InitComboBox", "DataComboBox", new { Area = "UserControl" }))
                    .Reader(X.JsonReader().RootProperty("data"))
                    )
                .Parameters(ps =>
                {
                    ps.Add(new StoreParameter("ParentVariable", "App." + (string)ViewData["DataComboBox_ID"] + "_ParentVariable" + ".getValue()", ParameterMode.Raw));
                    ps.Add(new StoreParameter("sNowNames", "App." + (string)ViewData["DataComboBox_ID"] + "_NowNames" + ".getValue()", ParameterMode.Raw));
                    ps.Add(new StoreParameter("sNowValues", "App." + (string)ViewData["DataComboBox_ID"] + "_NowValues" + ".getValue()", ParameterMode.Raw));
                    ps.Add(new StoreParameter("sNowSigns", "App." + (string)ViewData["DataComboBox_ID"] + "_NowSigns" + ".getValue()", ParameterMode.Raw));
                })
                .DirectEvents(de =>
                {
                    de.Load.Url = Url.Action("SetComboBoxValue", "DataComboBox", new { Area = "UserControl" });
                    de.Load.ExtraParams.Add(new Parameter("PanelID", ((string)ViewData["DataComboBox_ID"]), ParameterMode.Value));
                    de.Load.ExtraParams.Add(new Parameter("sNowID", "App." + (string)ViewData["DataComboBox_ID"] + "_SetSelID" + ".getValue()", ParameterMode.Raw));
                    //de.Load.EventMask.ShowMask = true;
                    //de.Load.EventMask.Msg = "正在加载,请稍后...";
                })
        )
        .DirectEvents(de =>
        {
            de.Blur.Url = Url.Action("EditDataComboBox", "DataComboBox", new { Area = "UserControl" });
            de.Blur.ExtraParams.Add(new Parameter()
            {
                Name = "PanelID",
                Value = ((string)ViewData["DataComboBox_ID"]),
                Mode = ParameterMode.Value
            });
            de.Blur.ExtraParams.Add(new Parameter()
            {
                Name = "sSelID",
                Value = "App." + (string)ViewData["DataComboBox_ID"] + "_GetSelID" + ".getValue()",
                Mode = ParameterMode.Raw
            });
            de.Blur.ExtraParams.Add(new Parameter()
            {
                Name = "ParentVariable",
                Value = "App." + (string)ViewData["DataComboBox_ID"] + "_ParentVariable" + ".getValue()",
                Mode = ParameterMode.Raw
            });
            de.Change.Url = Url.Action("SelectDataComboBox", "DataComboBox", new { Area = "UserControl" });
            de.Change.ExtraParams.Add(new Parameter()
            {
                Name = "PanelID",
                Value = ((string)ViewData["DataComboBox_ID"]),
                Mode = ParameterMode.Value
            });
            de.Change.ExtraParams.Add(new Parameter()
            {
                Name = "sSelID",
                Value = "this.getValue()",
                Mode = ParameterMode.Raw
            });
            de.Change.ExtraParams.Add(new Parameter()
            {
                Name = "ParentVariable",
                Value = "App." + (string)ViewData["DataComboBox_ID"] + "_ParentVariable" + ".getValue()",
                Mode = ParameterMode.Raw
            });
        })
)